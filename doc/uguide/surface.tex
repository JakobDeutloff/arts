\chapter{Geoid and surface properties}
 \label{sec:surface}


\starthistory
  110613 & Extended and revised (Patrick Eriksson). \\
  050613 & First version finished by Patrick Eriksson. \\
\stophistory


\graphicspath{{Figs/ppath/}}


\section{The geoid}
%===================
\label{sec:fm_defs:geoid}

The \textindex{geoid} is an imaginary surface used as a
reference when specifying the surface altitude and the altitude
of pressure levels. Any shape of the geoid is allowed but a smoothly
varying geoid is the natural choice, with the centers of the geoid and
the coordinate system coinciding. The geoid should normally be set to
the reference ellipsoid for some global geodetic datum, such as
WGS-84, see below.

Inside ARTS, the geoid is represented as a matrix (\wsvindex{r\_geoid}),
holding the geoid radius, \aRds{\odot}, for each crossing of the latitude and
longitude grids, $\aRds{\odot}=\aRds{\odot}(\Lat,\Lon)$. The geoid is not
defined outside the ranges covered by the latitude and longitude grids, with
the exception for 1D where the geoid by definition is a full sphere. 




\subsection{Geoid ellipsoids}
%===================
\label{sec:ppath:geoid}

A geodetic datums is based on a reference ellipsoid\index{geoid
  ellipsoid}. The ellipsoid is rotationally symmetric around the
north-south axis. That is, the ellipsoid radius has no longitude
variation, it is only a function of latitude. The ellipsoid is
described by an equatorial radius, \aRds{e}, and a polar radius,
\aRds{p}. These radii are indicated in Figure \ref{fig:ppath:lats}.
The radius of the ellipsoid for a given latitude is
\begin{equation}
 \aRds{\odot}(\Lat) = \sqrt{\frac{\aRds{e}^2\aRds{p}^2}
                    {\aRds{e}^2\sin^2\Lat+\aRds{p}^2\cos^2\Lat}}
 \label{eq:ppath:ellipsradius} 
\end{equation}
The radius given by Equation \ref{eq:ppath:ellipsradius} can be
directly applied for 2D and 3D cases. On the other hand, for 1D cases
the reference geoid is by definition a sphere and the radius of this
sphere shall be selected in such way that it represents the local
shape of a reference ellipsoid. This is achieved by setting
\aRds{\odot} to the radius of curvature of the ellipsoid. The
curvature radius differs from the local radius except at the equator
and an east-west direction. For example, at the equator and a
north-south direction, the curvature radius is smaller then the local
radius, while at the poles (for all directions) it is greater (see
further Figure \ref{fig:ppath:wgs84radii}). 
The \textindex{curvature radius}, \aRds{c}, of an ellipsoid is 
\citep{rodgers:00}
\begin{equation}
 \aRds{c} = \frac{1}{\aRds{ns}^{-1}\cos^2 \Lat + \aRds{ew}^{-1}\sin^2 \Lat}
 \label{eq:ppath:curvradius} 
\end{equation}
where \aRds{ns} and \aRds{ew} are the north-south and east-west curvature radius, respectively,
\begin{eqnarray}
 \aRds{ns} &=& \aRds{e}^2\aRds{p}^2 (
           \aRds{e}^2\cos^2\AzmAng+\aRds{p}^2\sin^2\AzmAng )^{-\frac{3}{2}} \\
 \aRds{ew} &=& \aRds{e}^2 (
           \aRds{e}^2\cos^2\AzmAng+\aRds{p}^2\sin^2\AzmAng )^{-\frac{1}{2}} 
 \label{eq:ppath:rew} 
\end{eqnarray}
The azimuth angle, \AzmAng, is defined in
Section \ref{sec:fm_defs:los}. The latitude and azimuth angle to
apply in Equations \ref{eq:ppath:curvradius}--\ref{eq:ppath:rew}
shall rather be valid for a middle point of the propagation paths
(such as some tangent point), instead of the sensor position. 

\begin{figure}
 \begin{center}
  \begin{minipage}[c]{0.65\textwidth}
   \begin{center}
    \includegraphics*[width=0.9\hsize]{latitudes}
   \end{center}
  \end{minipage}%
  \begin{minipage}[c]{0.35\textwidth}
   \caption{Definition of the ellipsoid radii, \aRds{e} and \aRds{p}, 
     geocentric latitude, \Lat, and geodetic latitude, \Lat$^*$. The
     dotted line is the normal to the local tangent of the geoid
     ellipsoid. The zenith and nadir directions, and geometrical
     altitudes, are here defined to follow the solid line.}
   \label{fig:ppath:lats}
  \end{minipage}
 \end{center}
\end{figure}   

\begin{figure}
 \begin{minipage}[c]{0.65\textwidth}
 \includegraphics*[width=0.96\textwidth]{wgs84_radii}
 \end{minipage}%
 \begin{minipage}[c]{0.35\textwidth}
  \caption{The ellipsoid radius (\aRds{\odot}) and curvature radius (\aRds{c})
    for the
    WGS-84 reference ellipsoid. The curvature radii are valid for the
    north-south direction.}
  \label{fig:ppath:wgs84radii}
 \end{minipage}%
\end{figure}   
        
\begin{figure}
 \begin{minipage}[c]{0.65\textwidth}
 \includegraphics*[width=0.96\textwidth]{wgs84_latdiff}
 \end{minipage}%
 \begin{minipage}[c]{0.35\textwidth}
  \caption{The change of the WGS-84 ellipsoid radius for  1\degree\ 
            latitude differences.}
  \label{fig:ppath:latdiff}
 \end{minipage}%
\end{figure}   

%\begin{figure}
% \begin{center}
%  \includegraphics*[width=0.80\hsize]{wgs84_dz}
%  \caption{The altitude above the geoid as a function of latitude
%    when using the WGS84 reference ellipsiod (solid line) and when
%    using a spherical geoid (dashed line). The radius in the latter
%    case is set to the curvature radius of WGS84 at 45\degree, in the
%    direction (north-south) of the simulated measurement. The two
%    propagation paths share the same tangent point (defined by a
%    zenith angle of 90\degree) at latitude 45\degree, but the lowest
%    geometrical altitude is slightly shifted from that position with
%    an ellipsiodal geoid.}
%  \label{fig:ppath:wgs84_dz}  
% \end{center}
%\end{figure}
% This figure was produced by the Matlab function mkfigs_geoid

Table \ref{tab:ppath:geodatums} gives the equatorial and polar radii
of the reference ellipsoid for the geodetic datums handled by ARTS.

\begin{table}
  \begin{center}
    \begin{tabular}{c c c c l}
     Datum & \aRds{e} & \aRds{p} & $1/f$ & Reference \vspace*{1mm} \\ 
     \hline 
     WGS-84 & 6378.137 km & \emph{6356.752 km} & 298.2572235 & {\small \citet{montenbruck:00}}  \rule{0mm}{5mm} \vspace*{1mm} \\
     \hline
    \end{tabular}
    \caption{Equatorial and polar radius of reference ellipsoids. Values 
      given as \emph{italic} are 
      derived by the other two values and Equation \ref{eq:ppath:flattening}.}
    \label{tab:ppath:geodatums}
  \end{center}
\end{table}


\subsection{Geocentric and geodetic latitudes}
%===================
\label{sec:ppath:geolat}

The fact that the geoid is an ellipsoid, instead of a sphere, opens up
for the two different definitions of the latitude. The
\textindex{geocentric latitude}, which is the the one used here, is the
angle between the equatorial plane and the vector from the coordinate
system center to the position of concern. The \textindex{geodetic
  latitude} is also defined with respect to the equatorial plane, but
the angle to the normal to the reference ellipsoid is considered here, as
shown in Figure \ref{fig:ppath:lats}. It could be mentioned that a
geocentric latitude does not depend on the geoid ellipsoid used, while
the geodetic latitudes change if another reference ellipsoid is
selected. An approximative relationship between the geodetic
($\Lat^*$) and geocentric (\Lat) latitudes is \citep{montenbruck:00}
\begin{equation}
 \Lat^* = \Lat + f\,\sin(2\Lat)  
 \label{eq:ppath:lats}
\end{equation}
where $f$ is the flattening of the ellipse:
\begin{equation}
 f = \frac{\aRds{e}-\aRds{p}}{\aRds{e}}
 \label{eq:ppath:flattening}
\end{equation}
The value of $f$ for the Earth is about 1/298.26. This means that the
largest differences between \Lat\ and $\Lat^*$ are found at
mid-latitudes and the maximum value is about 12 arc-minutes.

The \textindex{zenith} and \textindex{nadir} directions shall normally be
defined to follow the normal to the reference ellipsoid, but, if
nothing else is mentioned, these directions are here treated to go
along the vector the center of the coordinate system, as indicated in
Figure \ref{fig:ppath:lats}. This latter definition is preferred
as it results in that a propagation path in the zenith/nadir direction
can be described by a single latitude and longitude value. The
difference in geometrical altitude when using these two possible
definitions on the zenith direction is proportional to the deviation
between geocentric and geodetic latitude (Equation \ref{eq:ppath:lats}).
For an altitude of 100\,km around $\Lat=45\degree$, the difference is
about 350\,m.






\section{Surface altitude}
%===================

The surface altitude, \aAlt{g}, is given as the geometrical altitude above the
geoid. The radius for the surface is accordingly
\begin{equation}
  \aRds{g} = \aRds{\odot} + \aAlt{g}
 \label{eq:fm_defs:zsurface}
\end{equation}
As also mentioned in Section~\ref{sec:fm_defs:surf}, a gap between the surface
and the lowermost pressure level is not allowed.

The ARTS variable for the \textindex{surface altitude}
(\wsvindex{z\_surface}) is a matrix of the same size as the geoid
matrix. For 1D, the surface is a sphere by definition (as the geoid),
while for 2D and 3D any shape is allowed and a rough model of the
surface topography can be made. 




\section{Surface emission and reflection}
%===================

Section~\ref{T-sec:sec:rtetheory:surface} of \theory provides the theoretical
background for this part.


\subsection{Main surface workspace variables}
\label{sec:surface:surface:wsvs}
%--------------
An introduction to the treatment of surface emission and reflections is given
in Section \ref{sec:fm_defs:surface}. As described in that section, the surface
properties are described by three workspace variables and the methods developed
to handle different surface properties set these variables:
\wsvindex{surface\_emission}, \wsvindex{surface\_los} and
\wsvindex{surface\_rmatrix}. The sections below outlines the methods avaliable,
how these set the output variables.


\subsection{Blackbody surface}
%
If the surface can be assumed to act as a blackbody, the workspace method
\wsmindex{surfaceBlackbody} can be used. This method sets
\artsstyle{surface\_emission} to $[B,0,0,0]^T$, and \artsstyle{surface\_los}
and \artsstyle{surface\_rmatrix} to be empty.




\subsection{Specular reflections}
%
Several methods to incorporate a flat surface exist, including
\wsmindex{surfaceFlatRefractiveIndex} and
\wsmindex{surfaceFlatSingleEmissivity}. The methods differ in how the delectric
properties of the surface are given, and if these are constant or not with
frequency.

In the case of specular reflections, \artsstyle{surface\_los} has the length 1.
The specular direction is calculated by the internal function
\funcindex{surface\_specular\_los}\footnote{Any tilt of the surface is
  neglected when determining the specular direction. If there would be any need
  to consider surface tilt, almost complete code for this task existed in
  \artsstyle{surface\_specular\_los} but was removed in version 1-1-876. The
  code can be obtained by e.g.\ checking out version 1-1-875.}. Equations
\ref{T-sec:eq:surface:specular_matrix}-\ref{T-sec:eq:surface:specular_emission}
in \theory give the values of \artsstyle{surface\_rmatrix} and
\artsstyle{surface\_emission}.



\subsection{Lambertian surface}
%---
Basic treatment of Lambertian surfaces is provided by method
\wsmindex{surfaceLambertianSimple}. This method assumes that the down-welling
radiation has no azimuthal dependency, which is the case for 1D atmospheres.
The number of angles to apply in \artsstyle{surface\_los} is selected by the
user.

For a Lambertian surface the reflected radiation is unpolarised (thus
indpendent of the polarisation of the downwelling radiation). That is,
each \artsstyle{surface\_rmatrix} has the structure:
\begin{equation}
  \MtrStl{R} =
     \left[\begin{array}{cccc}
       w&0&0&0\\
       0&0&0&0\\
       0&0&0&0\\
       0&0&0&0\\
     \end{array}
     \right].
\end{equation}
The ``weight'' $w$ is obtained from Equation~\ref{T-sec:eq:surface:brdf2} of
\theory. The method \artsstyle{surfaceLambertianSimple} assumes that the
down-welling radiance ($I$) is constant is constant inside each zenith angle
range $[\theta_a,\theta_b]$, and with $[\phi_a,\phi_b]$ = $[0,2\pi]$, we get
\begin{equation}
  w = \frac{r_d}{2}\left[\cos(2\theta_a)-\cos(2\theta_b)\right].
\end{equation}
The emission (\artsstyle{surface\_emission}) becomes:
\begin{equation}
  \label{eq:surface:blambertian} 
  \VctStl{b} =  \left[\begin{array}{c} r_dB \\ 0 \\0\\0 \end{array}\right].
\end{equation}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "main"
%%% TeX-master: "uguide"
%%% End: 
