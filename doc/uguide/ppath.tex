%
% To start the document, use
%  \levela{...}
% For lover level, sections use
%  \levelb{...}
%  \levelc{...}
%
\levela{Propagation paths}
 \label{sec:ppath}

%
% Document history, format:
%  \starthistory
%    date1 & text .... \\
%    date2 & text .... \\
%    ....
%  \stophistory
%
\starthistory
  02xxxx & xxx.\\
\stophistory


%
% Symbol table, format:
%  \startsymbols
%    ... & \verb|...| & text ... \\
%    ... & \verb|...| & text ... \\
%    ....
%  \stopsymbols
%
%
%\startsymbols
%  \Ind           & -                 & vector/matrix/tensor index           \\
%  \aInd{\Lat}    & -                 & the \Ind:th latitude                 \\
%  \VctLng        & -                 & vector length or size of matrix/tensor for a dimension \\
%  \aVctLng{\Lat} & -                 & length of the latitude grid \\
%  \Prs           & \verb|p|          & pressure                             \\
%  \PrsAlt        & \verb|pz|         & pressure altitude                    \\
%  \Rds           & \verb|r|          & radius from the geoid centre         \\
%  \Alt           & \verb|z|          & geometrical altitude above the geoid \\
%  \Lat           & \verb|alpha|      & latitude                             \\
%  \Lon           & \verb|beta|       & longitude                            \\
%  \ZntAng        & \verb|psi|        & zenith angle                         \\
%  \AzmAng        & \verb|omega|      & azimuthal angle                      \\
% \label{symtable:ppath_defs}     
%\stopsymbols




\levelb{Geoid ellipsoids and geodetic datums}
%===================
\label{sec:ppath:geoids}

This section defines the geoid ellipsoid and discusses releated
issues. The geoid is introduced in Section~\ref{sec:fm_defs:geoid}.
The workspace variable representing the geoid is \verb|r_geoid|.


\levelc{Geoid ellipsoids}
%===================
\label{sec:ppath:geoid}

All geodetic datums are based on a reference ellipsoid\index{geoid
  ellipsoid}. The ellipsoid is rotationally symmetric around the
north-south axis. That is, the ellipsoid radius has no longitude
variation, it is only a function of latitude. The ellipsoid is
described by a equatorial radius, \aRds{e}, and a polar radius,
\aRds{p}. These radii are indicated in Figure~\ref{fig:ppath:lats}.
The radius of the ellipsoid for a given latitude is
\begin{equation}
 \aRds{\odot}(\Lat) = \sqrt{\frac{\aRds{e}^2\aRds{p}^2}
                    {\aRds{e}^2\sin^2\Lat+\aRds{p}^2\cos^2\Lat}}
 \label{eq:ppath:ellipsradius} 
\end{equation}
The radius given by Equation~\ref{eq:ppath:ellipsradius} can be
directly applied for 2D and 3D cases. On the other hand, for 1D cases
the reference geoid is by definition a sphere and the radius of this
sphere shall be selected in such way that it represents the local
shape of a reference ellipsoid. This is achieved by setting
\aRds{\odot} to the radius of curvature of the ellipsoid. The
curvature radius differs from the local radius except at the equator
and an east-west direction. For example, at the equator and a
north-south direction, the curvature radius is smaller then the local
radius, while at the poles (for all directions) it is greater
(see further Figure~\ref{fig:ppath:wgs84radii}). 

The \qindex{curvature radius}, \aRds{c}, of an ellipsoid is 
\citep{rodgers:00}
\begin{equation}
 \aRds{c} = \frac{1}{\aRds{ns}^{-1}\cos^2 \Lat + \aRds{ew}^{-1}\sin^2 \Lat}
 \label{eq:ppath:curvradius} 
\end{equation}
where \aRds{ns} and \aRds{ew} are the north-south and east-west curvature radius, respectively,
\begin{eqnarray}
 \aRds{ns} &=& \aRds{e}^2\aRds{p}^2 (
           \aRds{e}^2\cos^2\AzmAng+\aRds{p}^2\sin^2\AzmAng )^{-\frac{3}{2}} \\
 \aRds{ew} &=& \aRds{e}^2 (
           \aRds{e}^2\cos^2\AzmAng+\aRds{p}^2\sin^2\AzmAng )^{-\frac{1}{2}} 
 \label{eq:ppath:rew} 
\end{eqnarray}
The azimuth angle, \AzmAng, is defined in
Section~\ref{sec:fm_defs:los}. The latitude and azimuthal angle to
apply in Equations \ref{eq:ppath:curvradius}~-~\ref{eq:ppath:rew}
shall rather be valid for a middle point of the propagation paths
(such as some tangent point), instead of the sensor position. 

\begin{figure}[!p]
 \begin{center}
  \begin{minipage}[c]{0.65\textwidth}
   \begin{center}
   \begin{picture}(200,165)(0,0)
    \put(30,10){\arc{301}{-1.05}{-0.55}}
    \put(43,138){{\small geoid ellipsoid}}
    \put(0,10){\vector(1,0){70}}
    \put(70,4){$x$}
    \put(10,0){\vector(0,1){70}}
    \put(4,70){$y$}
    \dottedline(30,10)(170,150)
    \put(30,10){\arc{20}{-.76}{0}}
    \put(40,13){\Lat$^*$}
    \put(136.07,116.07){\line(1,-1){20}}
    \put(136.07,116.07){\line(-1,1){20}}
    \put(158,94){\small\shortstack[l]{local\\tangent}}
    \drawline(10,10)(170,144.4)
    \put(10,10){\arc{20}{-.73}{0}}
    \put(160,130){{\small zenith}}
    \put(20,13){\Lat}
    %
    \put(30,10){\arc{310}{-.15}{0.05}}
    \put(150,10){\vector(1,0){35}}
    \put(170,14){\aRds{e}}
    \put(10,10){\arc{290}{-1.6708}{-1.4708}}
    \put(10,120){\vector(0,1){35}}
    \put(13,140){\aRds{p}}
   \end{picture}
   \end{center}
  \end{minipage}%
  \begin{minipage}[c]{0.35\textwidth}
   \caption{Definition of the ellipsoid radii, \aRds{e} and \aRds{p}, 
     geocentric latitude, \Lat, and geodetic latitude, \Lat$^*$. The
     dotted line is the normal to the local tangent of the geoid
     ellipsoid. The zenith and nadir directions, and geometrical
     altitudes, are here defined to follow the solid line.}
   \label{fig:ppath:lats}
  \end{minipage}
 \end{center}
\end{figure}   

\begin{figure}[!p]
 \begin{minipage}[c]{0.65\textwidth}
 \includegraphics*[width=0.96\textwidth]{ppath/wgs84_radii}
 \end{minipage}%
 \begin{minipage}[c]{0.35\textwidth}
  \caption{Ellipsoid (\aRds{\odot}) and curvature (\aRds{c}) radii for the
    WGS-84 reference ellipsoid. The curvature radii are valid for the
    north-south direction.}
  \label{fig:ppath:wgs84radii}
 \end{minipage}%
\end{figure}   
        
\begin{figure}[!p]
 \begin{minipage}[c]{0.65\textwidth}
 \includegraphics*[width=0.96\textwidth]{ppath/wgs84_latdiff}
 \end{minipage}%
 \begin{minipage}[c]{0.35\textwidth}
  \caption{The change of the WGS-84 ellipsoid radius for  1\degree\ 
            latitude differences.}
  \label{fig:ppath:latdiff}
 \end{minipage}%
\end{figure}   



\levelc{Geocentric and geodetic latitudes}
%===================
\label{sec:ppath:geolat}

The fact that the geoid is an ellipsoid, instead of a sphere, opens up
for the two different definitions of the latitude. The
\qindex{geocentric latitude}, which is the the one used here, is the
angle between the equatorial plane and the vector from the coordinate
system center to the position of concern. The \qindex{geodetic
  latitude} is also defined with respect to the equatorial plane, but
the angle to the normal to the reference ellipsoid is considered here, as
shown in Figure~\ref{fig:ppath:lats}. It could be mentioned that a
geocentric latitude does not depend on the geoid ellipsoid used, while
the geodetic latitudes change if another reference ellipsoid is
selected. An approximative relationship between the geodetic
($\Lat^*$) and geocentric (\Lat) latitudes is \citep{montenbruck:00}
\begin{equation}
 \Lat^* = \Lat + f\,\sin(2\Lat)  
 \label{eq:ppath:lats}
\end{equation}
where $f$ is the flattening of the ellipse:
\begin{equation}
 f = \frac{\aRds{e}-\aRds{p}}{\aRds{e}}
 \label{eq:ppath:flattening}
\end{equation}
The value of $f$ for the Earth is about 1/298.26. This means that the
largest differences between \Lat\ and $\Lat^*$ are found at
mid-latitudes and the maximum value is about 12 arc-minutes.

The \qindex{zenith} and \qindex{nadir} directions shall normally be
defined to follow the normal to the reference ellipsoid, but, if
nothing else is mentioned, these directions are here treated to go
along the vector the center of the coordinate system, as indicated in
Figure~\ref{fig:ppath:lats}. This latter definition is preferred
as it results in that a propagation path in the zenith/nadir direction
can be described by a single latitude and longitude value. The
difference in geometrical altitude when using these two possible
definitions on the zenith direction is proportional to the deviation
between geocentric and geodetic latitude (Equation~\ref{eq:ppath:lats}).
For an altitude of 100~km around $\Lat=45\degree$, the difference is
about 350~m.


\levelc{Geodetic datums}
%===================
\label{sec:ppath:geodatums}

Table~\ref{tab:ppath:geodatums} gives the equatorial and polar radii
of the reference ellipsoid for the geodetic datums handled by ARTS.

\begin{table}[!h]
  \begin{center}
    \begin{tabular}{c c c c l}
     Datum & \aRds{e} & \aRds{p} & $1/f$ & Reference \vspace*{1mm} \\ 
     \hline 
     WGS-84 & 6378.137 km & \emph{6356.752 km} & 298.257223563 & {\small \citet{montenbruck:00}}  \rule{0mm}{5mm} \vspace*{1mm} \\
     \hline
    \end{tabular}
    \caption{Radii of reference ellipsoids. Values given as \emph{italic} are 
      derived by the other two values and Equation~\ref{eq:ppath:flattening}.}
    \label{tab:ppath:geodatums}
  \end{center}
\end{table}



\levelb{The propagation path data structure}
%===================
\label{sec:ppath:Ppath}



\levelb{Some basic geometrical relationships}
%===================
\label{sec:ppath:basicgeom}



\levelb{1D propagations paths}
%===================
\label{sec:ppath:1D}


\levelc{Without refraction}
%===================
\label{sec:ppath:1Dwithout}


\levelc{With refraction}
%===================
\label{sec:ppath:1Dwith}



\levelb{2D propagations paths}
%===================
\label{sec:ppath:2D}


\levelc{Without refraction}
%===================
\label{sec:ppath:2Dwithout}


\levelc{With refraction}
%===================
\label{sec:ppath:2Dwith}



\levelb{3D propagations paths}
%===================
\label{sec:ppath:3D}


\levelc{Without refraction}
%===================
\label{sec:ppath:3Dwithout}


\levelc{With refraction}
%===================
\label{sec:ppath:3Dwith}



\levelb{Control file examples}
%===================
\label{sec:ppath:cfile}




%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "uguide"
%%% End: 

