%
% To start the document, use
%  \levela{...}
% For lover level, sections use
%  \levelb{...}
%  \levelc{...}
%
\levela{The forward model: concepts, definitions and overview}
 \label{sec:fm_defs}

%
% Document history, format:
%  \starthistory
%    date1 & text .... \\
%    date2 & text .... \\
%    ....
%  \stophistory
%
\starthistory
  020330 & Structure for the chapter fixed, and absorption, compulsory sensor 
           variables and part of RTE sections written by Patrick Eriksson.\\
\stophistory


%
% Symbol table, format:
%  \startsymbols
%    ... & \artsstyle{...} & text ... \\
%    ... & \artsstyle{...} & text ... \\
%    ....
%  \stopsymbols
%
%
\startsymbols
  \Ind           & \artsstyle{i}         & vector/matrix/tensor index        \\
  \aInd{\Lat}    & \artsstyle{i\_alpha}  & the \Ind:th latitude              \\
  \VctLng        & \artsstyle{n}         & vector length or size of matrix/tensor for a dimension \\
  \aVctLng{\Lat} & \artsstyle{n\_alpha}  & length of the latitude grid       \\
  $e_g$          & \artsstyle{e\_ground} & ground emissivity                 \\
  \Prs           & \artsstyle{p}         & pressure                          \\
  \PrsAlt        & \artsstyle{pz}        & pressure altitude                 \\
  \Rds           & \artsstyle{r}         & radius from the centre of the coordinate system         \\
  \Tmp           & \artsstyle{t}         & temperature                       \\
  \Alt           & \artsstyle{z}         & geometrical altitude above the geoid \\
  \Planck        & \artsstyle{source}    & Planck function                   \\
  \Lat           & \artsstyle{alpha}     & latitude                          \\
  \Lon           & \artsstyle{beta}      & longitude                         \\
  \ZntAng        & \artsstyle{psi}       & zenith angle                      \\
  \AzmAng        & \artsstyle{omega}     & azimuthal angle                   \\
  \MpiVct        & \artsstyle{mpi}       & vector with monochromatic pencil beam values \\
  \MsrVct        & \artsstyle{y}         & measurement vector                \\
  \SnsMtr        & \artsstyle{h}         & sensor and data reduction transfer matrix \\
 \label{symtable:fm_defs}     
\stopsymbols



This chapter introduces terms and concepts of ARTS as a forward model,
in contrast to the previous chapter that describes ARTS as a computer
programme. While the content of the previous chapter is specific for
ARTS, as the way to use a forward model programme differ normally
significantly from one implementation to another, this chapter is of
more general nature. Most of the quantities treated here should be
part of any forward model of the same complexity as ARTS, where only
details regarding the definition should differ. The aim of this
chapter is to give an overview of the forward model and to describe
important terms and concepts, in such way that the content of this user
guide can be fully appreciated and that you shall understand how to
construct a control file for your simulation problem.



\levelb{Mathematics}
%==============================================================================
\label{sec:fm_defs:math}

[* A short introduction to the vectors, matrices and tensors should be
found here. It should be described what the terms means, the standard
order in which dimensions are given, how sizes are specified here in
the guide, how different dimensionalities are handled etc.

Vectors, matrices and tensors are indexed using round braces.
It should normally not be needed to specify the size. If you want to
show in what order the dimensions are put into the variable, use the
notation:
\begin{equation}
  \Alt = \Alt(\Prs,\Lat,\Lon)
\end{equation}
If the a special size shall be given, give the size inside square
brackets and spell out that you refer to the size. An example, 
``the matrix describing the geoid has for 1D the size $[1,1]$''.

The concept of rows, columns, pages etc. should be described so a
particular dimension can be identified in a consistent manner.

The indexing is 0-based as in ARTS. *]



\levelb{The atmosphere}
%==============================================================================
\label{sec:fm_defs:atmosphere}


\levelc{Atmospheric dimensionality}
%===================
\label{sec:fm_defs:atmdim}

The structure of the modelled atmosphere can be selected to have
different degree of complexity, the \textindex{atmospheric
  dimensionality}. There exist three levels for the complexity of the
atmosphere, 1D, 2D and 3D, where 1D and 2D can be treated as special
cases of 3D. The significance of these different atmospheric
dimensionalities and the coordinate systems used are described below
in this section. The atmospheric dimensionality is selected by setting
the workspace variable \wsvindex{atmosphere\_dim} to a value between 1
and 3. Variables for which the size depends on the atmospheric
dimensionality are checked, when used, to have a size consistent with
\artsstyle{atmosphere\_dim}. The atmospheric dimensionality is most
easily set by the functions \wsfindex{SetAtmosphere1D},
\wsfindex{SetAtmosphere2D} and \wsfindex{SetAtmosphere3D}.

\begin{description}
  
\item[\textindex{3D}\,\,\,] In this, the most general, case, the
  atmospheric fields vary in all three spatial coordinates, as in a
  true atmosphere. A \textindex{spherical coordinate system} is used where the
  dimensions are radius (\Rds), latitude (\Lat) and longitude (\Lon),
  and a position is given as $(\Rds,\Lat,\Lon)$. With other words, the
  standard way to specify a geographical position is followed.
  However, the way to specify the radial position differs depending on
  the context, which is described in
  Section~\ref{sec:fm_defs:altitudes}. The valid range for latitudes
  is $[-90\degree,+90\degree]$, where +90\degree corresponds to the
  North pole etc. Longitudes are counted from the Greenwich meridian
  with positive values towards the east. Longitudes can have values
  from -360\degree to +360\degree. When the difference between the
  last and first value of the longitude grid is $\geq 360\degree$ then
  the whole globe is considered to be covered. The user must ensure
  that the atmospheric fields for \Lon\ and $\Lon+360\degree$ are
  equal. If a point of propagation path is found to be outside the
  range of the longitude grid, this will results in an error if not
  the whole globe is covered. Otherwise, the longitude is shifted with
  360\degree\ in the relevant direction.
  
\item[\textindex{1D}\,\,\,] A 1D atmosphere can be described as being
  spherically symmetric. The term 1D is used here for simplicity and
  historical reasons, not because it is a true 1D case (a strictly 1D
  atmosphere would just extend along a line). A spherical symmetry
  means that atmospheric fields and the ground extend in all three
  dimensions, but they have no latitude and longitude variation. This
  means that, for example, atmospheric fields vary only as a function
  of altitude and the ground constitutes the surface of a sphere. The
  radial coordinate is accordingly sufficient when dealing with
  atmospheric quantities, but the angular distance between the sensor
  and a point along the propagation path can be of interest, for
  example when determining the cross-link between two satellites (a
  fact that shows that this is not a true 1D case). A polar coordinate
  system is for this reason used when describing propagation paths,
  where the coordinate additional to the radius gives the angular
  distance inside the viewing plane between the sensor and the point
  of interest (see also Section~\ref{sec:ppath:Ppath}). This latter
  coordinate system coincides with the one used for 2D if the sensor
  position is set to be the zero point for the latitudes. A 1D
  atmosphere is shown in Figure~\ref{fig:fm_defs:1d}.
  
\item[\textindex{2D}\,\,\,] In contrast to the 1D and 3D cases, a 2D
  atmosphere extends only inside a plane. A spherical coordinate
  system is accordingly not needed and a polar system\index{polar
    coordinate system}, consisting of a radial and an angular
  coordinate, is used. The 2D case is most likely used for satellite
  measurements where the atmosphere is observed inside the orbit
  plane. The angular coordinate corresponds then to the angular
  distance along the satellite track, but the coordinate is for
  simplicity denoted as the latitude. The zero point for the 2D
  latitude is arbitrary. No lower and upper limit exists for the 2D
  latitude, and this allows that measurements from several subsequent
  orbits can be simulated as one unit. The atmosphere is treated to be
  undefined outside the considered plane. A 2D atmosphere is shown in
  Figure~\ref{fig:fm_defs:2d}.

\end{description}

\begin{figure}[!t]
 \begin{center}
  \includegraphics*[width=0.95\hsize]{Figs/fm_definitions/atm_dim_1d}
  \caption{A schematic cross-section of a 1D atmosphere. The atmosphere is 
    here spherically symmetric. This means that the radius of the
    geoid, the ground and all the pressure surfaces is constant. The
    cloud box extends here from the ground up to the thin solid line
    (no blackbody ground assumed). The upper limit of the cloud box
    coincides always with a pressure surface. }
  \label{fig:fm_defs:1d}  
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_atm_dims.

\begin{figure}[!t]
 \begin{center}
  \includegraphics*[width=0.95\hsize]{Figs/fm_definitions/atm_dim_2d}
  \caption{ Schematic of a 2D atmosphere. The radii of the geoid, the ground
    and all the pressure surfaces are for 2D atmospheres allowed to
    have a latitude variation. The limits of the cloud box coincide
    always with grid box boundaries. A blackbody ground is assumed
    here as the cloud box does not extend down to the ground. }
  \label{fig:fm_defs:2d}
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_atm_dims.


\levelc{Altitude coordinates}
%===================
\label{sec:fm_defs:altitudes}

\begin{description}
  
\item[Pressure\index{pressure}] The main altitude coordinate is
  pressure. This is most clearly manifested by the fact that the
  vertical atmospheric grid consists of surfaces with equal pressure.
  The vertical grid is consistently denoted as the pressure grid and
  the corresponding workspace variable is called \wsvindex{p\_grid}. The
  choice of having pressure as main altitude coordinate results in
  that atmospheric quantities are retrieved as a function pressure,
  not as a function of geometrical altitude.
  
\item[Pressure altitude\index{pressure altitude}] A basic assumption
  in ARTS is that atmospheric quantities (temperature, geometric
  altitude, species VMR etc.) vary linear with the logarithm of the
  pressure. This corresponds roughly to assuming a linear variation
  with altitude. To obtain a more intuitive unit for the logarithm of
  the pressure, the quantity pressure altitude, \PrsAlt, is
  introduced, and it is defined as
  \begin{equation}
   \PrsAlt = \aPrsAlt{s}\left( \log_{10}(\aPrs{0}) - \log_{10}(\Prs) \right)
   \label{eq:fm_defs:prsalt}
  \end{equation}
  where \aPrsAlt{s} and \aPrs{0} are arbitrary parameters (set in
  \fileindex{arts.h}), but suitably selected in such way that the pressure
  altitude corresponds roughly with the geometrical altitude.  This
  correspondence is achieved if the two parameters are treated as a
  fixed scale height (for decreases of the pressure with a factor of
  10) and the surface pressure, respectively. Values around
  $\aPrsAlt{s}=15.5$~km and $\aPrs{0}=1013$~hPa are suitable for
  simulations dealing with the Earth's atmosphere.
  
\item[Radius\index{radius}] Geometrical altitudes are
  needed to determine the propagation path through the atmosphere etc.
  The main geometrical altitude coordinate is the distance to the
  centre of the coordinate system used, the radius. This is a natural
  consequence of using a spherical or polar coordinate system. The
  radius is used inside ARTS for all geometrical calculations and to
  store the position of the sensor (Section~
  \ref{sec:fm_defs:sensor1}).
  
\item[Geometrical altitude\index{geometrical altitude}] The term
  geometrical altitude signifies here the difference in radius between
  a point and the geoid (Section~\ref{sec:fm_defs:geoid}) along the
  vector to the centre of the coordinate system
  (Equation~\ref{eq:fm_defs:zground}). Hence, the geometrical altitude
  is not measured along the local zenith direction (the normal to the
  reference geoid). Geometrical altitudes are mainly used to
  facilitate the input of the ground altitude, the altitude of the
  pressure surfaces etc. This is the case as these quantities are known
  rather with respect to the geoid than with respect to the Earth's
  centre.

\end{description}


\levelc{Atmospheric grids and fields}
%===================
\label{sec:fm_defs:grids}

As mentioned above, the vertical grid of the atmosphere consists of a
set of layers with equal pressure, the pressure grid
(\wsvindex{p\_grid}).  This grid must of course always be specified.
It is not allowed that there is an altitude gap between the ground and
the lowermost pressure surface.  That is, the ground pressure must be
smaller than the pressure of the lowermost vertical grid surface. On
the other hand, it is not necessary to match the ground and the first
pressure surface, the pressure grid can extend below the ground level.
The upper end of the pressure grid gives the practical upper limit of
the atmosphere as vacuum is assumed above. With other words, no
absorption and refraction take place above the uppermost pressure
surface.

A \textindex{latitude} grid (\wsvindex{lat\_grid}) must be specified
for 2D and 3D.  For 2D, the latitudes shall be treated as the angular
distance along the orbit track, as described above in
Section~\ref{sec:fm_defs:atmdim}.  The latitude angle is throughout
calculated for the vector going from the centre of the coordinate
system to the point of concern. Hence, the latitudes here correspond
to the definition of the geocentric latitude, and not geodetic
latitudes (see Section~\ref{sec:ppath:geoid}). This is an accordance
to the definition of geometric altitudes found above.  For 3D, a
\textindex{longitude} grid (\wsvindex{lon\_grid}) must also be specified.
Valid ranges for latitude and longitude values are given in
Section~\ref{sec:fm_defs:atmdim}.

The atmosphere is treated to be undefined outside the latitude and
longitude ranges covered by the grids, if not the whole globe is
covered. This results in that a propagation path is not allowed to
cross a latitude or longitude end face of the atmosphere, if such
exists, it can only enter or leave the atmosphere through the top of
the atmosphere (the uppermost pressure level). See further
Section~\ref{sec:fm_defs:ppaths}. The volume (or area for 2D) covered
by the grids is denoted as the \textindex{model atmosphere}.

If the longitude and latitude grids are not used for the selected
atmospheric dimensionality, then the longitude grid (for 1D and 2D)
and the latitude grid (for 1D) must be set to be empty, but when
dealing with the size of variables the grid length shall be treated to
be one. For example, the matrix describing the geoid (see
Section~\ref{sec:fm_defs:geoid}) has for 1D the size $[1,1]$.

The basic atmospheric quantities are represented by their values at
each crossing of the involved grids (indicated by thick dots in
Figure~\ref{fig:fm_defs:2d}), or for 1D at each pressure surface
(thick dots in Figure~\ref{fig:fm_defs:1d}). This representation is
denoted as the field\index{atmospheric field} of the quantity. The
field must, at least, be specified for the geometric altitude of the
pressure surfaces (\wsvindex{z\_field}), the temperature
(\wsvindex{t\_field}) and considered atmospheric species
(\artsstyle{vmr\_field}).  The fields are assumed to be piece-wise
linear functions vertically (with pressure altitude as the vertical
coordinate, Section~\ref{sec:fm_defs:altitudes}), and along the
latitude and longitude edges of 2D and 3D grid boxes. For points
inside 2D and 3D grid boxes, multidimensional linear interpolation is
applied (that is, bilinear interpolation for 2D etc.). Note especially
that this is also valid for the field of geometrical altitudes
(\artsstyle{z\_field}). Fields are rank-3 tensors. For example, the
temperature field is $T=T(\Prs,\Lat,\Lon)$. That means each field is
like a book, with one page for each pressure grid point, one row for
each latitude grid point, and one column for each longitude grid
point. In the 1-D case there is just one row and one column on each
page.



\levelc{The geoid and the ground}
%===================
\label{sec:fm_defs:geoid}

The \textindex{geoid} is an imaginary surface used as a
reference when specifying the ground altitude and the altitude
of pressure surfaces. Any shape of the geoid is allowed but a smoothly
varying geoid is the natural choice, with the centres of the geoid and
the coordinate system coinciding. The geoid should normally be set to
the reference ellipsoid for some global geodetic datum, such as
WGS-84. For further reading on geoid ellipsoids and WGS-84, see
Section~\ref{sec:ppath:geoid}.

Inside ARTS, the geoid is represented as a matrix
(\wsvindex{r\_geoid}), holding the geoid radius, \aRds{\odot}, for
each crossing of the latitude and longitude grids,
$\aRds{\odot}=\aRds{\odot}(\Lat,\Lon)$. The geoid is not defined
outside the ranges covered by the latitude and longitude grids, with
the exception for 1D where the geoid by definition is a full sphere.
The ground altitude, \aAlt{g}, is given as the geometrical altitude
above the geoid. The radius for the ground is accordingly
\begin{equation}
  \aRds{g} = \aRds{\odot} + \aAlt{g}
 \label{eq:fm_defs:zground}
\end{equation}
As described in
Section~\ref{sec:fm_defs:grids}, it is not allowed that there is a gap
between the ground and the lowermost pressure level.

The ARTS variable for the \textindex{ground altitude}
(\wsvindex{z\_ground}) is a matrix of the same size as the geoid
matrix. For 1D, the ground is a sphere by definition (as the geoid),
while for 2D and 3D any shape is allowed and a rough model of the
ground topography can be made. For example, for limb sounding into the
troposphere, it could be of importance to capture the intersection of
the antenna beam by the Himalayas, and maybe other mountain ridges.
However, it should be noted that ground reflections are treated in a
simplified manner and accurate results cannot be expected beside when
some conditions are fulfilled (see
Section~\ref{sec:fm_defs:groundrefl}).

The temperature of the ground\index{ground temperature} (\aTmp{g}) is
described by the matrix \wsvindex{t\_ground} that has the same size as
\artsstyle{r\_geoid} and \artsstyle{z\_ground}. The \textindex{ground
  emission} is described by the variable \wsvindex{e\_ground}, holding
the ground emission factor $(e_g)$ of the ground, as a function of
frequency for each latitude/longitude position. This workspace
variable is a tensor of order 3, $e_g = e_g(\Frq,\Lat,\Lon)$. The
emission from the ground is $e_g(\Frq)\Planck(\Frq,\aTmp{g})$, where
\Planck\ is the Planck blackbody function. That is, the emissivity is
a value between 0 and 1, where 0 means that the ground has no
emissivity, and for $e_g=1$ the ground acts as a blackbody for that
particular frequency.

\begin{description}
\item[Blackbody ground\index{blackbody ground}] The ground can be
  treated to act as a blackbody, which is of importance for the cloud
  box and determination of propagation paths
  (Section~\ref{sec:fm_defs:cloudbox} and \ref{sec:fm_defs:ppaths},
  respectively). This feature is selected by the variable
  \wsvindex{blackbody\_ground}. For consistency reasons,
  \artsstyle{e\_ground} is demanded to only contain ones when
  \artsstyle{blackbody\_ground} is set to 1, but the size $[1,1,1]$ is
  then allowed also for 2D and 3D to save memory. The ground is only
  treated to be a blackbody when \artsstyle{blackbody\_ground} is set
  to 1. If \artsstyle{e\_ground} only contains 1, but
  \artsstyle{blackbody\_ground} is set to 0, the calculations will be
  performed such as the radiation is reflected by the ground. A
  blackbody ground is most easily selected by the function
  \wsfindex{SetBlackbodyGround}.
\end{description}


\levelc{The cloud box}
%===================
\label{sec:fm_defs:cloudbox}

In order to save computational time, scattering calculations are
limited as far as possible to the part of the atmosphere containing
clouds and other scattering objects. The atmospheric region in which
scattering shall be considered is denoted as the \textindex{cloud box},
and it is discussed here as it acts as an additional atmospheric limit
when calculating propagation paths (see
Section~\ref{sec:fm_defs:rte}).

The cloud box is defined in such way that a propagation path entering
the cloud box at one position has not crossed the cloud box boundary
at any other location (remember that there is no scattering outside
the cloud box). This requires in general that the lower limit of the
cloud box is the ground. This is the case as if there is a gap between
the ground and the cloud box, paths entering the cloud box from below
after a ground reflection have passed through the cloud box on the way
down, at least for propagations paths close to nadir. However, with a
blackbody ground (Section~\ref{sec:fm_defs:geoid}), there is
effectively no ground reflection
(Section~\ref{sec:fm_defs:groundrefl}) and a gap below the cloud box
is allowed.

The cloud box is defined to be rectangular in the used coordinate
system, with limits exactly at points of the involved grids. This
means, for example, that the vertical limits of the cloud box are two
pressure surfaces. If the ground is not a blackbody, the lower limit
must be set to the lowest pressure surface (index 0). For 2D, the
angular extension of the cloud box is between two points of the
latitude grid (Figure~\ref{fig:fm_defs:2d}), and likewise for 3D but
then also with a longitude extension between two grid points.  The
latitude and longitude limits for the cloud box cannot be placed at
the end points of the corresponding grid as it must be possible to
calculate the incoming intensity field. The cloud
box is activated by setting the variable \wsvindex{cloudbox\_on} to 1. The
limits of the cloud box are stored in \wsvindex{cloudbox\_limits}.

There exists in fact a small risk for 2D or 3D, and with a reflecting
ground, that a propagation path into the cloud box has earlier crossed
the box boundaries. This can happen for propagation paths close to the
nadir direction and if the ground is tilted in such way that the
surface of the ground points towards the cloud box. The first crossing
of the cloud box is neglected for such cases, the cloud box is simply
turned off when determining the radiation field going into the cloud
box.


\levelb{Absorption and refractive index}
%==============================================================================
\label{sec:fm_defs:absorption}

[* Considerations for the calculation of absorption and refractive
index ...  Tags, line-by-line, absorption models etc. The old
\artsstyle{f\_mono} should be called \artsstyle{f\_mono}, or? (Note that I
have used the name \wsvindex{f\_grid} elsewhere.)*]



\levelb{Compulsory sensor and data reduction variables}
%==============================================================================
\label{sec:fm_defs:sensor1}

The instrument that detects the simulated radiation is denoted as the
sensor\index{sensor, the}. The forward model is constructed in such
way that a sensor must exists. For cases when only monochromatic
pencil beam radiation is of interest, the positions and directions for
which the radiation shall be calculated are given by specifying an
imaginary sensor with infinite frequency and angular resolution. The
workspace variables for the sensor that always must be specified are
\artsstyle{sensor\_pos}, \artsstyle{sensor\_los},
\artsstyle{sensor\_pol}, \artsstyle{antenna\_dim},
\artsstyle{psi\_block\_grid}, \artsstyle{omega\_block\_grid} and
\artsstyle{Hb}. These variables are presented separately below in this
section. The discussion of sensor workspace variables is continued in
Section~\ref{sec:fm_defs:sensor2}. The Section~\ref{sec:fm_defs:rte}
gives further insights in how the sensor is treated in ARTS.


\levelc{Sensor position\index{sensor position}}
%===================
\label{sec:fm_defs:sensorpos}

The observation positions of the sensor are stored in
\wsvindex{sensor\_pos}. This is a matrix where each row corresponds to a
sensor position. The number of columns in the matrix equals the
atmospheric dimensionality (1 column for 1D etc.). The columns of the
matrix (from first to last) are radius, latitude and longitude.
Accordingly, row $i$ of \artsstyle{sensor\_pos} for a 3D case is
$(\aRds{i},\aLat{i},\aLon{i})$. The sensor position can be set to any
value, but the resulting propagation paths (also dependent on
\artsstyle{sensor\_los}) must be valid with respect to the model atmosphere
(see Section~\ref{sec:fm_defs:ppaths}). An obviously incorrect choice
is to place the senor below the ground altitude. If the sensor is
placed inside the model atmosphere, any sensor line-of-sight is
allowed, this including the cases that the sensor is placed on the
ground looking down, and that the sensor is placed on the boundary of
the cloud box and looks into the box. The sensor can also be placed
inside the cloud box.

The fact that the sensor position can be given any value results in
that the radius must be used in \artsstyle{sensor\_pos}, in contrast
to \artsstyle{z\_ground} and \artsstyle{z\_field} where the altitude
above the geoid is applied. This is the case as the sensor can for 2D
and 3D be placed outside the covered latitude and longitude ranges,
thus outside the defined geoid and the geometrical altitude is
undefined. See Section~[**] for hints on how to simply set the sensor
position.

The sensor is treated to be motionless when calculating the spectrum,
or spectra, for each given observation position. One or several
spectra can be calculated for each position as described in
Section~\ref{sec:fm_defs:seqsandblocks}.


\levelc{Line-of-sight\index{line-of-sight}}
%===================
\label{sec:fm_defs:los}

The viewing direction of the sensor, the line-of-sight, is described
with two angles, the zenith angle (\ZntAng) and the azimuth angle
(\AzmAng). The zenith angle exists for all atmospheric
dimensionalities, while the azimuthal angle is defined only for 3D.
The term line-of-sight is not only used in connection with the sensor,
it is also used to describe the local propagation direction along the
path taken by the observed radiation
(Section~\ref{sec:fm_defs:ppaths}).  The zenith and azimuthal angles
are defined identical in these two contexts. This is expected as the
position of the sensor is the end point of the propagation path. The
line-of-sight of \textindex{propagation path}s is defined in the
direction the radiation travels to reach the sensor, while the sensor
line-of-sight is the direction the antenna is pointed to receive the
radiation. This means that the sensor and path line-of-sights (at the
sensor) are parallel but go in opposite directions. As a true sensor
has a limited spatial resolution (described by the antenna pattern),
theoretically there are an infinite number of line-of-sights
associated with the sensor, but in the forward model spectra are only
calculated for a discrete set of directions. If a sensor line-of-sight
is mentioned without any comments, it refers to the direction in which
the centre of the antenna pattern is directed.

\begin{figure}[!t]
 \begin{center}
  \begin{minipage}[c]{0.4\textwidth}
   \begin{picture}(100,110)
    \put(10,10){\vector(0,1){100}}
    \put(0,114){zenith}
    \put(10,10){\vector(1,0){100}}
    \put(97,0){north}
    \put(10,10){\vector(-1,0){20}}
    \put(-20,0){south}
    \put(10,10){\vector(1,1){80}}
    \put(65,93){line-of-sight}
    \put(10,10){\arc{40}{-1.5708}{-0.7854}}
    \put(18,34){\ZntAng}
    \dottedline(90,90)(90,35)(10,10)
    \drawline(85,33.4)(85,38.4)(90,40)
    \put(10,10){\arc{50}{-.3}{0}}
    \put(38,12){\AzmAng}
   \end{picture}
  \end{minipage}%
  \begin{minipage}[c]{0.50\textwidth}
   \caption{Definition of zenith angle, \ZntAng, and azimuthal angle, 
       \AzmAng, for a line-of-sight. The figure shows a line-of-sight
       with a negative azimuthal angle.}
   \label{fig:fm_defs:los}
  \end{minipage}
 \end{center}
\end{figure}           
 
The \textindex{zenith angle}, \ZntAng, is simply the angle between the
line-of-sight and the zenith direction (Figure~\ref{fig:fm_defs:los}).
The valid range for 1D and 3D cases is $[0,180\degree]$. In the case
of 2D, zenith angles down to -180\degree are also allowed, where the
distinction is that positive angles mean a viewing direction is
towards higher latitudes, and vice versa. It should be mentioned that
the zenith and nadir directions are here defined to be along the line
passing the centre of the coordinate system and the point of concern
(Section~\ref{sec:ppath:geoid}). A nadir observation,
$\ZntAng=180\degree$, is thus a measurement towards the centre of the
coordinate system. The maximum absolute value of a zenith angle is
180\degree. For 1D and 3D, positive and negative zenith angles are
treated identically, while for 2D a distinction is made.

The \textindex{azimuthal angle}, \AzmAng, is given with respect to the
\textindex{meridian plane}, that is, the plane going through the north
and south poles of the coordinate system $(\Lat=\pm90\degree)$ and the
sensor. The valid range is $[-180\degree,180\degree]$ where angles are
counted clockwise and 0\degree means that the viewing or propagation
direction is north-wise.  Hence, +90\degree means that the direction
of concern goes eastward.

The line-of-sight for propagation paths is discussed further in
Section~\ref{sec:fm_defs:ppaths}. The sensor line-of-sights are stored in
\wsvindex{sensor\_los}. This workspace variable is a matrix, where the
first column holds zenith angles and the second column is azimuthal
angles. For 1D and 2D there is only one column in the matrix, while
for 3D a row $i$ of the matrix is $(\aZntAng{i},\aAzmAng{i})$. The
number of rows for \artsstyle{sensor\_los} must be the same as for
\artsstyle{sensor\_pos}.


\levelc{Sensor polarisation\index{sensor polarisation}}
%===================
\label{sec:fm_defs:sensorpol}

[* How shall this be handled? Can a transfer matrix be used?
\wsvindex{sensor\_pol} *]


\levelc{Sensor characteristics and data reduction}
%===================
\label{sec:fm_defs:sensorchar}

Sensor characteristics\index{sensor characteristics} is used here as a
comprehensive term for the response of all sensor parts, beside
polarisation effects, that affect how the field of monochromatic
pencil beam intensities are translated to the recorded spectrum. For
example, the antenna pattern, the side-band filtering and response of
the spectrometer channels are normally the most important
characteristics for a microwave heterodyne radiometer. Any processing
of the spectral data that takes place before the retrieval is denoted
as \textindex{data reduction}. The most common processing is to represent
the original spectra with a smaller set of values, that is, a
reduction of the data size. The most common data reduction techniques
is binning and Hotelling transformation by an eigenvector expansion
(Section~[**]).

The influence of sensor characteristics and data reduction is in ARTS
incorporated by transfer matrices\index{sensor transfer matrix}, as
described in Section~\ref{sec:formalism:sensor}. The application of
these transfer matrices assumes that each step is a linear operation,
which should be the case for the response of the parts of a well
designed instrument. Non-linear data reduction is handled by special
workspace functions.

The creation of sensor and data reduction transfer matrices is not
(yet?) included in ARTS and no workspace variables exist to describe
the individual sensor parts etc. The sensor and data reduction are
described as a series of units, each having its own transfer matrix.
There is only one compulsory transfer matrix and it is \aSnsMtr{b}
(\wsvindex{Hb}), where the subscript $b$ stands for block (see further
Section~\ref{sec:fm_defs:seqsandblocks}). There are several workspace
variables associated with this transfer matrix where
\wsvindex{antenna\_dim}, \wsvindex{psi\_block\_grid} and
\wsvindex{omega\_block\_grid} are the compulsory ones.

The variable \artsstyle{antenna\_dim} gives the dimensionality of the
antenna pattern\index{antenna pattern dimensionality}, where the
options are 1 and 2, standing for 1D and 2D, respectively. A 1D
antenna dimensionality means that the azimuthal extension of the
antenna pattern is neglected, there is only a zenith angle variation
of the response. A 2D antenna pattern is converted to a 1D pattern by
integrating the azimuthal response for each zenith angle. ARTS handles
not yet 2D antenna patterns, the only allowed choice for
\artsstyle{antenna\_dim} is 1, and the variable
\artsstyle{omega\_block\_grid} has yet no importance (but it must be
initiated, to be empty, before calling \artsstyle{rteCalc}). The
presentation below assumes that the 2D option is implemented.

For each sensor position, a number of monochromatic pencil beam
spectra are calculated. The monochromatic frequencies are given by
\artsstyle{f\_grid} (Section~\ref{sec:fm_defs:absorption}). The pencil
beam directions are obtained by summing the line-of-sight angles
(\artsstyle{sensor\_los}) for the position and the values of
\artsstyle{psi\_block\_grid} and \artsstyle{omega\_block\_grid}. For
example, pencil beam zenith angle $i$ is calculated as
\begin{equation}
  \aZntAng{i} = \aZntAng{0} + \Delta\aZntAng{i}
  \label{eq:fm_defs:psi_grid}
\end{equation}
where \aZntAng{0} is the sensor line-of-sight for the position of
concern and $\Delta\aZntAng{i}$ is value $i$ of
\artsstyle{psi\_block\_grid}.  With other words,
\artsstyle{psi\_block\_grid} and \artsstyle{omega\_block\_grid} give
the grid (relative to the sensor line-of-sight) for the calculation of
the intensity field that will be weighted with the antenna response.
For cases with 1D antenna patterns, \artsstyle{omega\_block\_grid}
must be set to be an empty vector.


\levelc{Measurement sequences and blocks}
%===================
\label{sec:fm_defs:seqsandblocks}

The series of observations modelled by the simulations is denoted as
the \textindex{measurement sequence}. That is, a measurement sequence
covers all spectra recorded at all considered sensor positions
(\artsstyle{sensor\_pos}). A measurement sequence consists of one or several
\textindex{measurement block}s. The observations inside the various
blocks differ only with an off-set of the line-of-sight, all other
factors should be common for all blocks. A block can be treated as a
measurement cycle that is repeated, an integer number of times, to
form the measurement sequence.  The measurement blocks correspond
normally to each unique sensor position of the sequence.

A measurement block cover one or several recorded spectra, depending
on the measurement conditions and the atmospheric dimensionality. A
block can consists of several spectra when there is no effective
motion of the sensor with respect to the atmospheric fields. It should
be noted that for 1D cases, a motion along a constant radius has no
influence on the simulated spectra as the same atmospheric fields are
seen for a given viewing direction. It is favourable, if possible, to
handle all spectra as a single block, instead of using a block for
each sensor position. This is the case as the antenna patterns for the
different line-of-sights are normally overlapping and a pencil beam
spectrum can be used in connection with several measurement spectra to
estimate the intensity field. If a measurement sequence is divided
into several blocks even if a single block would be sufficient, pencil
beam spectra for basically identical propagation paths can be
calculated several times, which of course is unnecessary. To
summerise, for cases when the sensor is not in motion, or with a 1D
atmosphere and a sensor not moving vertically, the aim should be to
use a single block for the measurement sequence.

If not a single block is used, the standard option should be that the
blocks cover one spectrum each. There could exist reasons to select an
intermediate solution, to let the extent of the blocks be several
spectra (but not the full measurement sequence). This could be the
case when the atmospheric dimensionality is 2D or 3D, and the sensor
is moving but the movement during some subsequent spectra can be
neglected. If this can be done must be judged by comparing the
movement of the satellite during the extent of the considered block
size and the spatial resolution, in the direction of the movement, that
is hoped to be achieved. If this intermediate solution shall be an
option, the difference in zenith and azimuthal angles between the
spectra must be the same for all blocks, otherwise \aSnsMtr{b} cannot
be applied for all blocks as done in Equation~\ref{eq:fm_defs:measseq}.

For each block, pencil beam spectra are calculated for the
line-of-sights obtained when summing \wsvindex{sensor\_los} and
\wsvindex{psi\_block\_grid} (and possibly
\wsvindex{omega\_block\_grid}), as described in
Section~\ref{sec:fm_defs:sensorchar}. The pencil beam spectra for each
line-of-sight are appended vertically to form a common vector,
\aMpiVct{b}. Values are put in following the order in
\artsstyle{f\_grid}. Hence, the frequencies for this vector are
\begin{equation}
  \aMpiVct{b} = 
  \left[ \begin{array}{c} 
     \left[
          \begin{array}{c} \aFrq{1}\\\vdots\\\aFrq{{n_\Frq}} \end{array} 
     \right] \\
     \vdots \\
     \left[
          \begin{array}{c} \aFrq{1}\\\vdots\\\aFrq{{n_\Frq}} \end{array} 
     \right]
     \end{array} \right]
  \label{eq:fm_defs:freqs_of_ib}
\end{equation}
where \aFrq{i} is element $i$ of \artsstyle{f\_grid} and $n_\Frq$ the length of
the same vector. The order of the angles inside \artsstyle{psi\_block\_grid}
and \artsstyle{omega\_block\_grid} is followed when looping the pencil beam
directions, where the zenith angle direction is the innermost loop.
That is, for 2D antenna patterns all zenith angles are looped for the
first azimuthal angle etc. 

The transfer matrix \aSnsMtr{b} is applied on each \aMpiVct{b} and the
results are appended vertically, following the order of the positions
in \artsstyle{sensor\_pos}
\begin{equation}
  \MsrVct = \left[ \begin{array}{c} \aSnsMtr{b}\aMpiVct{{b,1}} \\ 
                                    \aSnsMtr{b}\aMpiVct{{b,2}} \\
                                    \vdots                     \\
                                    \aSnsMtr{b}\aMpiVct{{b,n}} 
            \end{array} \right]
  \label{eq:fm_defs:measseq}
\end{equation}
where \MsrVct\ is defined in Equation~\ref{eq:formalism:fm} and $1$
indicates the first sensor position etc. This equation shows that
\wsvindex{Hb} shall contain at least a description of the antenna
response. The matrix \artsstyle{Hb} can also cover other sensor
characteristics and data reduction if the features of concern are
common for all measurement blocks. If this is not the case, those
features must be handled by the other existing transfer matrices or, by
other means, as described in Section~\ref{sec:fm_defs:howtomeasseq}.

As the sensor line-of-sight and block grid values are just added,
there is an ambiguity of the line-of-sight. It is possible to apply a
constant off-set to the line-of-sights, if the block grids are
corrected accordingly. For example, if the simulations deal with limb
sounding and a 1D atmosphere, where normally a single block should be
used despite a number of spectra are recorded, it could be practical
to set the line-of-sight to the viewing direction of the uppermost or
lowermost spectrum, and the zenith angles in \artsstyle{psi\_block\_grid}
will not be centred around zero which is the case when the ``true''
line-of-sight is used.

It should be noted that the compulsory sensor variables give no
information about the content of the obtained \MsrVct, as it is not
clear which parts and features the block transfer matrix covers. If
\artsstyle{Hb} only incorporates the antenna pattern, the result is a set
of hypothetical spectra corresponding to a point inside the sensor. On
the other hand, if \artsstyle{Hb} includes the whole of the sensor and an
eigenvector data reduction, the result is not even a spectrum is
traditional way, it is just a row of coefficients with a vague
physical meaning. To handle quantities appearing at a stage between
monochromatic pencil beam intensities and the final representation of
the measurements (where the total transformation can involve more
steps than the multiplication with \artsstyle{Hb}), additional sensor
variables must be introduced, as described in
Section~\ref{sec:fm_defs:sensor2}.


\levelb{Clear sky radiative transfer}
%==============================================================================
\label{sec:fm_defs:rte}

\newcommand{\Int}{{\bf I}}
\newcommand{\Ext}{{\bf K}}
\newcommand{\Abs}{{\bf a}}
\newcommand{\Sca}{{\bf Y}}
\newcommand{\Dir}{{\bf n}}
\newcommand{\Path}{{\bf s}}
%\newcommand{\Planck}{{\bf B}}
\newcommand{\Freq}{\nu}
\newcommand{\Dep}{(\Dir,\Freq)}

\startsymbols
  \Ind           & -                 & vector/matrix/tensor index           \\
  \Int           & 
 \label{symtable:fm_defs_rt}     
\stopsymbols

% STEFAN, you should have a look at the file symbol_defs. The quantities for
% which you have defined commands should be of general interest and they should
% then be included in that file. For example, there are already macros for
% frequency (\Frq and \aFrq{i}).
%
% I see that you use a capital I for the intensity Stokes vector. I have so
% far (and I don't think there are any exceptions AUG) used lower case letters
% for vectors and upper case for matrices. I would be happy if we could stick
% to this rule, which I think is a standard way to keep matrices and vectors
% separated. Note the macro \MpiVct in symbol_defs.
%
% I just put in a macro for Planck, but then the scalar version. The Planck
% function here is really not a scalar? If not, maybe you can introduce the
% macro \VctPlanck? But what symbol should be used? Lower case b is already
% occupied.
%
% I also think that you should put ''your'' symbols in the table found at the
% start of the section as it is valid for the whole chapter. 
%
% Patrick

\levelc{Radiative transfer equation and important quantities}

The radiative transfer equation in the absence of cloud particles is
\citep{mishchenko00:_light_scatt_nonsp_partic}: 

\begin{equation}
  \label{eq:rte_4stokes_no_scat}
  \frac{d\Int\Dep}{d\Path} = - \Ext\Dep \Int\Dep + \Abs\Dep\Planck(T)
\end{equation}
where the meaning of the quantities in this equation is as follows:

The specific intensity vector $\Int$



 where $I$ is the monochromatic pencil beam intensity, $l$ distance
 along the line of sight (LOS), $l_1$ the point of the considered part
 of the LOS furthest away from the sensor, $l_2$ the closest point of
 the LOS, $I_1$ the intensity at $l_1$, $\kappa$ the total absorption
 along the LOS and $\sigma$ the source function.

[* Please consider also transmission measurements. *]


\levelc{Calculation procedure}
%===================
\label{sec:fm_defs:calcproc}

The overall structure of the part solving the radiative transfer
equation is fixed. The corresponding workspace function is
\wsfindex{rteCalc}. The calculation procedure of \artsstyle{rteCalc} is
outlined in Algorithm~\ref{alg:fm_defs:rteCalc}. For further details
of each calculation step, see the indicated equation or section.

Two types of spectra can be produced, emission and transmission
spectra. A transmission spectrum means that emission of the atmosphere
and the ground is neglected. This can be done if the measurements are
performed against a sufficient strong source, such as the sun. The
background source is not included in the simulations, the output is
instead the transmission through the atmosphere (in form of the
optical thickness, see below). The type of spectra is selected by the
workspace variable \wsvindex{emission\_on}. In some cases it is of interest
to have both the emission and the transmission spectra at hand
simultaneously. This is achieved by [* How? Can we have optional
output parameters? *]. Weighting functions are only calculated for the
option selected by \artsstyle{emission\_on}.

The primary unit for emission spectra, the unit of \aMpiVct{b} in
Equation~\ref{eq:fm_defs:measseq}, is [W/(Hz$\cdot$m$^2\cdot$sr)].
The emission intensity corresponds directly with the definition of the
Planck function in Equation~[**], no scaling terms are applied.
Conversion to brightness temperature is treated in Section~[**].  The
transmission is provided as the optical thickness (Equation~[**]).
The optical thickness includes the absorption of the ground if there
is a ground reflection along the propagation path.

The function \artsstyle{rteCalc}, beside providing atmospheric spectra,
performs also the calculation of weighting functions for atmospheric
variables where analytical expressions are used. The core of these
calculations follows Algorithm~\ref{alg:fm_defs:rteCalc}, but is not
considered here for simplicity. Weighting functions are treated in
Section~\ref{sec:fm_defs:wfs}.

\begin{algorithm}[!t]
 \begin{algorithmic}
  \IF[{Section \ref{sec:fm_defs:scattering}}]{cloud box is turned on}
   \STATE{determine the intensity field inside the cloud box}
  \ENDIF
  \STATE{allocate memory for the measurement vector, \MsrVct}
  \COMMENT{Equation \ref{eq:formalism:fm}}
  \FORALL{sensor positions}
   \STATE{allocate memory for the vector \aMpiVct{b}}
   \COMMENT{Equation \ref{eq:fm_defs:freqs_of_ib}}
   \FORALL[Section \ref{sec:fm_defs:seqsandblocks}]
                                    {pencil beam directions of the block}
    \STATE{determine the propagation path}
    \COMMENT{Section \ref{sec:fm_defs:ppaths}}
    \STATE{initialise the vector \MpiVct\ with the radiative background}
    \COMMENT{Section \ref{sec:fm_defs:ppaths}}
    \FORALL{steps along propagation path}
     \STATE{update \MpiVct\ following Equation [**]}
     \IF{at a point of ground reflection}
      \STATE{update \MpiVct\ following Equation [**]}
     \ENDIF
    \ENDFOR
    \STATE{copy \MpiVct\ to correct part of \aMpiVct{b}}
   \ENDFOR
   \STATE{put the product \aSnsMtr{b}\aMpiVct{b} in correct part of \MsrVct}
  \ENDFOR
 \end{algorithmic}
 \caption{Outline of the clear sky radiative transfer calculations. Only
   calculation of emission spectra is treated here.
   Optical thicknesses and weighting functions are
   determined in parallel, if selected, following the same scheme.}
 \label{alg:fm_defs:rteCalc}
\end{algorithm}


\levelc{Propagation paths}
%===================
\label{sec:fm_defs:ppaths}

A pencil beam path through the atmosphere to reach a specified
position from a specified line-of-sight is denoted as the
\textindex{propagation path}. The forward direction of the propagation
paths is towards the position for which the radiative intensity will
be calculated. It should be noted that with scattering there exist an
infinite number of propagation paths for a given combination of
observation point and line-of-sight.

Propagation paths are described by a set of points on the path, and
the distance along the path between the points. These quantities, and
a number of auxiliary variables, are stored together in a structure
described in Section~[**]. The path points are primarily placed at the
crossings of the path with the atmospheric grids (\artsstyle{p\_grid},
\artsstyle{lat\_grid} and \artsstyle{lon\_grid}). A path point is
also placed at the sensor if it is placed inside the atmosphere.
Ground reflections and tangent points are also included if such exist.
There exists also the possibility to set an upper limit for the
distance along the path between the points by the workspace variable
\wsvindex{ppath\_lmax}. If \artsstyle{ppath\_lmax} is set to a value $\leq 0$
then no points are added to the path, otherwise points are included to
fulfil the length criterion.

The propagation paths are determined basically by starting at the
sensor and following the path backwards by some \textindex{ray tracing}
technique.  If the sensor is placed above the model atmosphere,
geometrical calculations are used (as there is no refraction in space)
to find the crossing between the path and the top of the atmosphere
where the ray tracing then starts. If there is no cloud box and the
ground not acts as a blackbody, the starting point of the propagation
paths is always found at the top of the atmosphere (where the path
enters the atmosphere). Propagation paths are not followed inside
cloud boxes and the starting point is set to the cloud box boundary.
If there is an intersection with path of a blackbody ground
(Section~\ref{sec:fm_defs:geoid}), the propagation path is considered
to start at the ground. This is the case as a blackbody ground absorbs
all incoming radiation and the radiative transfer along the path
before the ground reflection is of no interest
(Equation~\ref{eq:fm_defs_ground_reflection}). Example on propagation
paths are shown in Figure~\ref{fig:fm_defs:ppath_cases1}.

\begin{figure}[!t]
 \begin{center}
  \includegraphics*[width=0.95\hsize]{Figs/fm_definitions/ppath_cases1}
  \caption{Propagation path examples for a 2D atmosphere. The atmosphere 
    and the cloud box are plotted as in Figure~\ref{fig:fm_defs:2d}
    beside that the points for the atmospheric fields are not
    emphasised. For the propagation paths to the left, with a the
    sensor placed inside the model atmosphere, a reflecting ground is
    assumed. The paths to the right are valid for a sensor placed
    outside the atmosphere (at the $*$) and a blackbody ground. No
    value for the maximum path step length was applied. Note the tangent
    point inserted for the uppermost propagation path, plotted as $\oplus$.}
  \label{fig:fm_defs:ppath_cases1}
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_ppath_cases.
 
The radiative intensity at the starting point of the path, and in the
direction of the line-of-sight at that point, is denoted as the
radiative background. The radiative background at the top of the
atmosphere is given by the workspace variable \wsvindex{i\_space}. This
variable should normally be set to cosmic background radiation, if
not the sensor is directed towards the sun. Remaining possible
radiative backgrounds are blackbody radiation from the ground or the
outgoing intensity field at the boundary of a cloud box. If a
propagation path is totally outside the model atmosphere, the
observed monochromatic pencil beam intensity (\MpiVct\ in
Algorithm~\ref{alg:fm_defs:rteCalc}) equals \artsstyle{i\_space}.

Not all propagation paths are allowed for 2D and 3D. The paths can
only enter and leave the model atmosphere at the top of the atmosphere
as the atmospheric fields are treated to be undefined outside the
covered latitude and longitude ranges. In addition, if the sensor is
placed outside the model atmosphere, the line-of-sight zenith angles
must be $\geq90\degree$, and the tangent point position of the
propagation paths must be inside the end points of the latitude and
longitude grids, but can be above the top of the atmosphere. Hence, it
is allowed that the propagation path is totally outside the
atmosphere, as long as the viewing direction is downward and the
lowest point of the path, then tangent point, is inside the latitude
and longitude limits of the model atmosphere. All combinations of
sensor position and sensor line-of-sight result in an allowed
propagation path for 1D atmospheres. 


\levelc{Solving the radiative transfer equation}
%===================
\label{sec:fm_defs:solverte}

[* Assumption on absorption and source function between the points of
the propagation path. Can the equation 
\begin{equation}
  \Mpi_{i+1}(\Frq) = \Mpi_i(\Frq)e^{-\aOth{i}} + B(\Frq,\aTmp{i})(1-e^{-\aOth{i}})
\end{equation}
be extended to cover Stokes vectors when there is no scattering? *]



\levelc{Ground reflections}
%===================
\label{sec:fm_defs:groundrefl}

The ground is treated to be a totally flat surface; incoming radiation
is only reflected in a single direction, with the normal assumption
that the angle to the surface normal is equal for the incoming and
outgoing line-of-sight. If there is slope of the ground\index{ground
  slope} (a variation of the ground radius), this slope is considered
when determining the line-of-sight for the incoming radiation
(remember that propagation paths are followed backwards). This is
exemplified in Figure~\ref{fig:fm_defs:ppath_cases2}, for a case with
a very strong ground slope.

\begin{figure}[!t]
 \begin{center}
  \includegraphics*[width=0.95\hsize]{Figs/fm_definitions/ppath_cases2}
  \caption{The influence of a ground slope on the propagation path. The zenith
    angle of the sensor line-of-sight is the same for the two paths (but with
    different sign, which matters here as this is a 2D case), and the paths
    would have been symmetric around the latitude of the sensor without a 
    ground slope. The maximum path step length is here set to be a value
    equalling half the vertical distance between the two shown pressure
    surfaces.}
  \label{fig:fm_defs:ppath_cases2}
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_ppath_cases.

When solving the radiative transfer equation, a ground reflection is
included as
\begin{equation}
  \Mpi(\Frq) \gets \Mpi(\Frq)(1-e_g(\Frq)) + e_g(\Frq)B(\Frq,\aTmp{g})
  \label{eq:fm_defs_ground_reflection}
\end{equation}
where $e_g$ and \aTmp{g} is the ground emissivity and temperature,
respectively, for the point where the ground reflection takes place.
Note that the ground emissivity can vary both with frequency and
position (Section~\ref{sec:fm_defs:geoid}).
Equation~\ref{eq:fm_defs_ground_reflection} shows that the path before
a reflection with a blackbody ground can be neglected. For such cases,
$\Mpi(\Frq)$ equals $B(\Frq,\aTmp{g})$ independently of the previous
value of $\Mpi(\Frq)$. The ground emission is treated to be
unpolarised.

A more detailed treatment of ground intersections would take into
account the scattering properties of the ground and this limitation of
the simulations should be considered. However, a requirement for that
the recorded spectra shall be affected considerably by the ground
properties is that the optical thickness of the lower troposphere is
not too high. If it is high, the radiation is absorbed before it
reaches the sensor. For moderate values on the optical thickness (in
rough numbers, $1.5<\tau<4$), when some radiation can propagate
from the ground to the sensor, it should be noted that the intensity
field (as a function of zenith angle) reaching the ground should be
relatively homogenous and the negligence of ground scattering will not
influence the accuracy of the results too seriously. With a high or
moderate optical thickness of the lower troposphere, the emission
reaching the ground will have brightness temperature close to the
physical temperatures of the lower troposphere, with a relatively low
angular variation. [* Does anybody know of important the scattering of
the ground is for nadir observations? For example, how large is the
scattering of the sea surface? *]



\levelb{Additional sensor and data reduction variables} 
%===================
\label{sec:fm_defs:sensor2}

\artsstyle{antenna\_psi\_grid}, \aSnsMtr{b}, \aSnsMtr{c}


\levelc{How to model different measurement sequences in best way?}
%===================
\label{sec:fm_defs:howtomeasseq}

[* Discuss e.g. the relationship between \artsstyle{sensor\_los} and the block LOS grids. *]


\levelb{Scattering}
%==============================================================================
\label{sec:fm_defs:scattering}

[* Special quantities and considerations for scattering ... *]



\levelb{Weighting functions}
%==============================================================================
\label{sec:fm_defs:wfs}

[* This part is still quite unclear. However, the analytical
atmospheric WFs will be calculated on the same time as spectra. We
need to find a good way to specify the WFs which is a complex thing to
do. *]


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "uguide"
%%% End: 
