\chapter{Description of the atmosphere}
 \label{sec:atmosphere}

\starthistory
 090424 & This section created by moving text from removed section (PE).\\ 
 020315 & Text by Patrick Eriksson (PE).\\
\stophistory

\graphicspath{{Figs/atmosphere/}}


\section{Atmospheric dimensionality}
%===================
\label{sec:fm_defs:atmdim}

The structure of the modelled atmosphere can be selected to have
different degree of complexity, the \textindex{atmospheric
  dimensionality}. There exist three levels for the complexity of the
atmosphere, 1D, 2D and 3D, where 1D and 2D can be seen as special
cases of 3D. The significance of these different atmospheric
dimensionalities and the coordinate systems used are described below
in this section. The atmospheric dimensionality is selected by setting
the workspace variable \wsvindex{atmosphere\_dim} to a value between 1
and 3. Variables for which the size depends on the atmospheric
dimensionality are checked, when used, to have a size consistent with
\artsstyle{atmosphere\_dim}. The atmospheric dimensionality is most
easily set by the functions \wsmindex{AtmosphereSet1D},
\wsmindex{AtmosphereSet2D} and \wsmindex{AtmosphereSet3D}.

\begin{figure}[!t]
 \begin{center}
  \includegraphics*[width=0.98\hsize]{atm_dim_1d}
  \caption{Schematic of a 1D atmosphere. The atmosphere is 
    here spherically symmetric. This means that the radius of the
    geoid, the surface and all the pressure levels are constant
    around the globe. The fields are specified by a value for each
    pressure level. The extension of the cloud box is either from
    the surface up to a pressure level, or between two pressure
    levels (which is the case shown in the figure). The figure shows
    further that the surface must be above the lowermost pressure
    level. }
  \label{fig:fm_defs:1d}  
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_atm_dims.

\begin{figure}[!t]
 \begin{center}
  \includegraphics*[width=0.98\hsize]{atm_dim_2d}
  \caption{Schematic of a 2D atmosphere. The radii (for the geoid, the surface
    and the pressure levels) vary here linear between the latitude
    grid points. The atmospheric fields vary linearly along the
    pressure levels and the latitude grid points (that is, along the
    dotted lines). Inside the grid cells, the fields have a bi-linear
    variation. The cloud box is not defined for 2D.  }
  \label{fig:fm_defs:2d}
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_atm_dims.

\begin{description}
  
\item[\textindex{3D}\,\,\,] In this, the most general, case, the
  atmospheric fields vary in all three spatial coordinates, as in a
  true atmosphere (Figures~\ref{fig:fm_defs:3d} and
  \ref{fig:fm_defs:3dcross}). A \textindex{spherical coordinate
    system} is used where the dimensions are radius (\Rds), latitude
  (\Lat) and longitude (\Lon), and a position is given as
  $(\Rds,\Lat,\Lon)$. With other words, the standard way to specify a
  geographical position is followed.  However, the way to specify the
  radial position differs depending on the context, which is described
  in Section~\ref{sec:fm_defs:altitudes}. The valid range for
  latitudes is $[-90\degree,+90\degree]$, where +90\degree corresponds
  to the North pole etc. Longitudes are counted from the Greenwich
  meridian with positive values towards the east. Longitudes can have
  values from -360\degree to +360\degree. When the difference between
  the last and first value of the longitude grid is $\geq 360\degree$
  then the whole globe is considered to be covered. The user must
  ensure that the atmospheric fields for \Lon\ and $\Lon+360\degree$
  are equal. If a point of propagation path is found to be outside the
  range of the longitude grid, this will results in an error if not
  the whole globe is covered. When possible, the longitude is shifted with
  360\degree\ in the relevant direction.
  
\item[\textindex{1D}\,\,\,] A 1D atmosphere can be described as being
  spherically symmetric (Figure~\ref{fig:fm_defs:1d}). The term 1D is
  used here for simplicity and historical reasons, not because it is a
  true 1D case (a strictly 1D atmosphere would just extend along a
  line). A spherical symmetry means that atmospheric fields and the
  surface extend in all three dimensions, but they have no latitude and
  longitude variation. This means that, for example, atmospheric
  fields vary only as a function of altitude and the surface
  constitutes the surface of a sphere. The radial coordinate is
  accordingly sufficient when dealing with atmospheric quantities, but
  the angular distance between the sensor and a point along the
  propagation path can be of interest, for example when determining
  the cross-link between two satellites (a fact that shows that this
  is not a true 1D case). A polar coordinate system is for this reason
  used when describing propagation paths, where the coordinate
  additional to the radius gives the angular distance inside the
  viewing plane between the sensor and the point of interest (see also
  Section~\ref{sec:ppath:Ppath}). This latter coordinate system
  coincides with the one used for 2D if the sensor position is set to
  be the zero point for the latitudes. A 1D atmosphere is shown in
  Figure~\ref{fig:fm_defs:1d}.
  
\item[\textindex{2D}\,\,\,] In contrast to the 1D and 3D cases, a 2D
  atmosphere extends only inside a plane
  (Figure~\ref{fig:fm_defs:2d}). A spherical coordinate system is
  accordingly not needed and a polar system\index{polar coordinate
    system}, consisting of a radial and an angular coordinate, is
  used. The 2D case is most likely used for satellite measurements
  where the atmosphere is observed inside the orbit plane. The angular
  coordinate corresponds then to the angular distance along the
  satellite track, but the coordinate is for simplicity denoted as the
  latitude. The zero point for the 2D latitude is arbitrary. No lower
  and upper limit exists for the 2D latitude, and this allows that
  measurements from several subsequent orbits can be simulated as one
  unit. The atmosphere is treated to be undefined outside the
  considered plane. A 2D atmosphere is shown in
  Figure~\ref{fig:fm_defs:2d}.

\end{description}

\begin{figure}[!p]
 \begin{center}
  \includegraphics*[angle=-90,width=0.98\hsize]{atm_dim_3d}
  \vspace*{-15mm}
  \caption{Schematic of a 3D atmosphere. Plotting symbols as in 
    Figure~\ref{fig:fm_defs:2d}. Radii and fields are here defined to
    vary linearly along the latitude and longitude grid points. This
    means that surfaces (such as the radius of the surface) have a
    bi-linear variation inside the area limited by two latitude and
    longitude grid values, while the atmospheric fields have a
    tri-linear variation inside the grid cells. }
  \label{fig:fm_defs:3d}
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_atm_dims.

\begin{figure}[!p]
 \begin{center}
  \includegraphics*[width=0.98\hsize]{atm_dim_3dcross}
  \caption{A latitudinal, or longitudinal, cross section of a 3D atmosphere. 
    Plotting symbols as in Figure~\ref{fig:fm_defs:1d}. Radii and
    fields inside the cross section match the definitions for 2D.
    The vertical extension
    of the cloud box is defined identical for 1D and 3D. The horizontal 
    extension of the cloud box is between two latitude and longitude grid
    positions, where only one of the dimensions are visible in this figure.}
  \label{fig:fm_defs:3dcross}
 \end{center}
\end{figure}
% This figure was produced by the Matlab function mkfigs_atm_dims.



\section{Altitude coordinates}
%===================
\label{sec:fm_defs:altitudes}

\begin{description}
  
\item[Pressure\index{pressure}] The main altitude coordinate is
  pressure. This is most clearly manifested by the fact that the
  vertical atmospheric grid consists of levels with equal pressure.
  The vertical grid is consistently denoted as the pressure grid and
  the corresponding workspace variable is \wsvindex{p\_grid}. The
  choice of having pressure as main altitude coordinate results in
  that atmospheric quantities are retrieved as a function of pressure,
  not as a function of geometrical altitude.
  
\item[Pressure altitude\index{pressure altitude}] A basic assumption
  in ARTS is that atmospheric quantities (temperature, geometric
  altitude, species VMR etc.) vary linearly with the logarithm of the
  pressure. This corresponds roughly to assuming a linear variation
  with altitude. 
%  To obtain a more intuitive unit for the logarithm of
%  the pressure, the quantity pressure altitude, \PrsAlt, is
%  introduced, and it is defined as
%  \begin{equation}
%   \PrsAlt = \aPrsAlt{s}\left( \log_{10}(\aPrs{0}) - \log_{10}(\Prs) \right)
%   \label{eq:fm_defs:prsalt}
%  \end{equation}
%  where \aPrsAlt{s} and \aPrs{0} are arbitrary parameters (set in
%  \fileindex{arts.h}), but suitably selected in such a way that the pressure
%  altitude corresponds roughly to the geometrical altitude.  This
%  correspondence is achieved if the two parameters are treated as a
%  fixed scale height (for decreases of the pressure by a factor of
%  10) and the surface pressure, respectively. Values around
%  $\aPrsAlt{s}=15.5$~km and $\aPrs{0}=1013$~hPa are suitable for
%  simulations dealing with the Earth's atmosphere.
  
\item[Radius\index{radius}] Geometrical altitudes are
  needed to determine the propagation path through the atmosphere etc.
  The main geometrical altitude coordinate is the distance to the
  centre of the coordinate system used, the radius. This is a natural
  consequence of using a spherical or polar coordinate system. The
  radius is used inside ARTS for all geometrical calculations and to
  store the position of the sensor (Section~
  \ref{sec:fm_defs:sensor1}).
  
\item[Geometrical altitude\index{geometrical altitude}] The term
  geometrical altitude signifies here the difference in radius between
  a point and the geoid (Section~\ref{sec:fm_defs:geoid}) along the
  vector to the centre of the coordinate system
  (Equation~\ref{eq:fm_defs:zsurface}). Hence, the geometrical altitude
  is not measured along the local zenith direction (the normal to the
  reference geoid). Geometrical altitudes are mainly used to
  facilitate the input of the surface altitude, the altitude of the
  pressure levels etc. This is the case as these quantities are known
  rather with respect to the geoid than with respect to the Earth's
  centre.

\end{description}



\section{Atmospheric grids and fields}
%===================
\label{sec:fm_defs:grids}

As mentioned above, the vertical grid of the atmosphere consists of a
set of layers with equal pressure, the pressure grid
(\wsvindex{p\_grid}).  This grid must of course always be specified.
It is not allowed that there is an altitude gap between the surface and
the lowermost pressure level.  That is, the surface pressure must be
smaller than the pressure of the lowermost vertical grid level. On
the other hand, it is not necessary to match the surface and the first
pressure level, the pressure grid can extend below the surface level.
The upper end of the pressure grid gives the practical upper limit of
the atmosphere as vacuum is assumed above. With other words, no
absorption and refraction take place above the uppermost pressure
level.

A \textindex{latitude} grid (\wsvindex{lat\_grid}) must be specified
for 2D and 3D.  For 2D, the latitudes shall be treated as the angular
distance along the orbit track, as described above in
Section~\ref{sec:fm_defs:atmdim}.  The latitude angle is throughout
calculated for the vector going from the centre of the coordinate
system to the point of concern. Hence, the latitudes here correspond
to the definition of the geocentric latitude, and not geodetic
latitudes (see Section~\ref{sec:ppath:geoid}). This is in accordance
to the definition of geometric altitudes found above.  For 3D, a
\textindex{longitude} grid (\wsvindex{lon\_grid}) must also be specified.
Valid ranges for latitude and longitude values are given in
Section~\ref{sec:fm_defs:atmdim}.

The atmosphere is treated to be undefined outside the latitude and
longitude ranges covered by the grids, if not the whole globe is
covered. This results in that a propagation path is not allowed to
cross a latitude or longitude end face of the atmosphere, if such
exists, it can only enter or leave the atmosphere through the top of
the atmosphere (the uppermost pressure level). See further
Section~\ref{sec:fm_defs:ppaths}. The volume (or area for 2D) covered
by the grids is denoted as the \textindex{model atmosphere}.

If the longitude and latitude grids are not used for the selected
atmospheric dimensionality, then the longitude grid (for 1D and 2D)
and the latitude grid (for 1D) must be set to be empty, but when
dealing with the size of variables the grid length shall be treated to
be one. For example, the matrix describing the geoid (see
Section~\ref{sec:fm_defs:geoid}) has for 1D the size $[1,1]$.

The basic atmospheric quantities are represented by their values at
each crossing of the involved grids (indicated by thick dots in
Figures~\ref{fig:fm_defs:1d}~-~\ref{fig:fm_defs:3dcross}), or for 1D
at each pressure level (thick dots in Figure~\ref{fig:fm_defs:1d}).
This representation is denoted as the field\index{atmospheric field}
of the quantity. The field must, at least, be specified for the
geometric altitude of the pressure levels (\wsvindex{z\_field}), the
temperature (\wsvindex{t\_field}) and considered atmospheric species
(\artsstyle{vmr\_field}).  The fields are assumed to be piece-wise
linear functions vertically (with pressure altitude as the vertical
coordinate, Section~\ref{sec:fm_defs:altitudes}), and along the
latitude and longitude edges of 2D and 3D grid boxes. For points
inside 2D and 3D grid boxes, multidimensional linear interpolation is
applied (that is, bilinear interpolation for 2D etc.). Note especially
that this is also valid for the field of geometrical altitudes
(\artsstyle{z\_field}). Fields are rank-3 tensors. For example, the
temperature field is $T=T(\Prs,\Lat,\Lon)$. That means each field is
like a book, with one page for each pressure grid point, one row for
each latitude grid point, and one column for each longitude grid
point. In the 1-D case there is just one row and one column on each
page.



\section{The cloud box}
%===================
\label{sec:fm_defs:cloudbox}

In order to save computational time, scattering calculations are
limited as far as possible to the part of the atmosphere containing
clouds and other scattering objects. The atmospheric region in which
scattering shall be considered is denoted as the \textindex{cloud
  box}, and it is discussed here as it acts as an additional
atmospheric limit when calculating propagation paths (see
Section~\ref{sec:fm_defs:rte}). Cloud box calculations can be
performed in 1D and 3D mode, but not for 2D.

The cloud box is defined to be rectangular in the used coordinate
system, with limits exactly at points of the involved grids. This
means, for example, that the vertical limits of the cloud box are two
pressure levels. For 3D, the horizontal extension of the cloud box
is between two points of the latitude grid and likewise in the
longitude direction (Figure~\ref{fig:fm_defs:3dcross}). The latitude
and longitude limits for the cloud box cannot be placed at the end
points of the corresponding grid as it must be possible to calculate
the incoming intensity field. The cloud box is activated by setting
the variable \wsvindex{cloudbox\_on} to 1.  The limits of the cloud
box are stored in \wsvindex{cloudbox\_limits}.  It is recommended to
use the method \wsmindex{CloudboxOff} when no scattering calculations
shall be performed. This method assigns dummy values to all workspace
variables not needed when scattering is neglected.

When the radiation entering the cloud box is calculated this is done
with the cloud box turned off. This to avoid to end up in the
situation that the radiation entering the cloud box depends on the
radiation coming out from the cloud box. {\bf It is the task of the
  user to define the cloud box in such way that the link between the
  outgoing and ingoing radiation fields of the cloud box can be
  neglected}. The main point to consider here is radiation reflected
by the surface. To be formally correct there should never be a gap
between the surface and the cloud box. This is the case as radiation
leaving the cloud box can then be reflected back into the cloud box by
the surface. If it is considered that the surface is a scattering object
it is clear that the surface should in general be part of the cloud
box. However, for many cases it can be accepted to have a gap between
the surface and the cloud box, with the gain that the cloud box can be
made smaller. Such a case is when the surface is treated to act as
blackbody, the surface is then not reflecting any radiation.
Reflections from the surface can also be neglected if the zenith
optical thickness of the atmosphere between the surface and cloud box
is sufficiently high.


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "uguide"
%%% End: 
