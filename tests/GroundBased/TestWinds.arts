#DEFINITIONS:  -*-sh-*-
# Simple simulations of ground-based measurements of ozone at 110.8 GHz,
# to test impact of winds.
#
# Author: Patrick Eriksson


Arts2 {

INCLUDE "general.arts"


# ---- f_grid ----------------------------------------------------------------

NumericCreate( v0 )
NumericSet( v0, 1.108360400e+11 )
VectorLinSpace( -5e6, 5e6, 50e3 )
VectorAddScalar( f_grid, f_grid, v0 )


# ---- Species ---------------------------------------------------------------

SpeciesSet( abs_species, [ "O3", "H2O" ] )


# ---- Atmospheric scenario --------------------------------------------------

# A pressure grid rougly matching 0 to 88 km in about 1 km steps.
VectorNLogSpace( p_grid, 90, 1.013e5, 0.5 )

AtmRawRead( t_field_raw, z_field_raw, vmr_field_raw, abs_species, 
                                  "../atmosphere_data/tropical" )
VectorSet( lat_grid, [ 10 ] )
AtmFieldsCalc


# ---- Absorption ------------------------------------------------------------

ReadXML( abs_lines, "ozone_line.xml" )
abs_lines_per_speciesCreateFromLines

abs_cont_descriptionInit

AgendaSet( abs_scalar_gas_agenda ){
  NumericScale( rte_doppler, rte_doppler, -1 )
  VectorAddScalar( f_grid, f_grid, rte_doppler )
  abs_scalar_gasCalcLBL
}


# ---- Observation geometry --------------------------------------------------

NumericCreate( z_platform )
NumericCreate( za )
 
# Platform altitude
NumericSet( z_platform, 50 )

# Zenith angle
NumericSet( za, 60 )

MatrixSetConstant( sensor_pos, 1, 1, z_platform )
Copy( z_surface, sensor_pos )
sensor_posAddRgeoid
MatrixSetConstant( sensor_los, 1, 1, za )


# ---- Finalise atmosphere ---------------------------------------------------

basics_checkedCalc
cloudbox_checkedCalc


yCalc
#
WriteXML( output_file_format, y, "TestWinds.y.xml" )
WriteXML( output_file_format, y_f, "TestWinds.y_f.xml" )



}