# This is a test doing Odin-SMR simulations. Same test as in
# testOdinSMR, but the calculations are here performed inside a single
# measurement block. This approach can only be used for 1D.
#
# Author: Patrick Eriksson


Arts {

# Select frequency band here:
#
INCLUDE "odinsmr_501_1D.arts"


# Possibility to change considered species
# For example
#SpeciesSet(abs_species){[
#  "H2O,H2O-ForeignContStandardType,H2O-SelfContStandardType",
#  "O3" ]
#}



# ---- Atmospheric scenario --------------------------------------------------

# A pressure grid rougly matching 0 to 80 km in 250 m steps.
# The pressure grid is for the SMR processing not uniform. It is created
# to be most dense over the actual range of tangent altitudes.
#
IndexSet(nelem){321}
VectorNLogSpace(p_grid){
  start = 1000e2
  stop  = 1
}

# This example assumes 1D
AtmosphereSet1D{}

# Here taken from Fascod
AtmRawRead{"tropical"}

AtmFieldsCalc{}

# get ground altitude (z_surface) from z_field
IndexSet(index_1){0}
MatrixExtractFromTensor3(z_surface,z_field,index_1)



# ---- Create absorption table -----------------------------------------------

abs_lines_per_speciesCreateFromLines{}

abs_lookupSetup{}

abs_lookupCreate{}

AgendaSet(abs_scalar_gas_agenda){
  abs_scalar_gasExtractFromLookup
}



# ---- Sensor position and LOS -----------------------------------------------

# Tangent altitudes are here determined when creating sensor response matrix.
# The tangent altitudes are stored in *vector_2*.


# ---- Calculate, switch to RF and save

RteCalc{}

ConvertIFToRF{}

WriteXML(sensor_response_f){""}
WriteXML(vector_2){"TestOdinSMR_1D.ztan.xml"}
WriteXML(y){""}

}
